{% extends "customer/base.html" %}
{% load static %}

{% block title %}Order {{ gift_box.name }} - Cakes by Desti{% endblock %}

{% block content %}
<!--Page Title-->
<section class="page-title" style="background-image:url({% static 'images/main-slider/slider_bg_3.png' %})">
    <div class="auto-container">
        <h1>Order Gift Box</h1>
        <ul class="page-breadcrumb">
            <li><a href="{% url 'home' %}">home</a></li>
            <li><a href="{% url 'gift_boxes' %}">Gift Boxes</a></li>
            <li>Order</li>
        </ul>
    </div>
</section>
<!--End Page Title-->

<section class="order-section" style="padding: 60px 0; background: #FFF9F5;">
    <div class="auto-container">
        <div class="order-form-card" style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); max-width: 900px; margin: 0 auto;">
            
            <!-- Gift Box Preview -->
            <div style="background: linear-gradient(135deg, #FFE5EC 0%, #FFF0F5 100%); padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        {% if gift_box.main_image %}
                        <img src="{{ gift_box.main_image.url }}" alt="{{ gift_box.name }}" style="width: 100%; border-radius: 10px;">
                        {% else %}
                        <div style="width: 100%; height: 150px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-gift fa-3x" style="color: #FF6B9D; opacity: 0.5;"></i>
                        </div>
                        {% endif %}
                    </div>
                    <div class="col-md-8">
                        <h3 style="color: #333; margin-bottom: 10px;">{{ gift_box.name }}</h3>
                        <p style="color: #666; margin-bottom: 10px;">{{ gift_box.description|truncatewords:20 }}</p>
                        <div style="color: #FF6B9D; font-size: 24px; font-weight: 700;">₹{{ gift_box.total_price|floatformat:0 }}</div>
                        <small style="color: #999;">Includes {{ gift_box.items_count }} items</small>
                    </div>
                </div>
            </div>

            <form method="post">
                {% csrf_token %}

                <!-- Customer Information -->
                <div class="form-section">
                    <h4 style="color: #FF6B9D; margin-bottom: 20px;">
                        <i class="fas fa-user" style="margin-right: 10px;"></i>Customer Information
                    </h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">Full Name</label>
                                <input type="text" class="form-control" name="customer_name" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="required">Phone Number</label>
                                <input type="tel" class="form-control" name="phone_number" pattern="[0-9]{10}" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>WhatsApp Number</label>
                                <input type="tel" class="form-control" name="whatsapp_number" pattern="[0-9]{10}">
                                <small class="text-muted">Leave empty to use phone number</small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" class="form-control" name="email">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Details -->
                <div class="form-section">
                    <h4 style="color: #FF6B9D; margin-bottom: 20px;">
                        <i class="fas fa-shopping-bag" style="margin-right: 10px;"></i>Order Details
                    </h4>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="required">Quantity</label>
                                <input type="number" class="form-control" name="quantity" min="1" value="1" required id="quantity">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label class="required">Delivery Date</label>
                                <input type="date" class="form-control" name="delivery_date" required min="{{ today|date:'Y-m-d' }}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <label>Delivery Time</label>
                                <input type="time" class="form-control" name="delivery_time">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Event/Occasion</label>
                        <select class="form-control" name="event">
                            <option value="">Select Event (Optional)</option>
                            {% for event in events %}
                            <option value="{{ event.id }}">{{ event.event_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Special Instructions</label>
                        <textarea class="form-control" name="special_instructions" rows="3" placeholder="Any special requirements or delivery instructions..."></textarea>
                    </div>
                </div>

                <!-- Order Summary -->
                <div class="order-summary" style="background: #FFF9F5; padding: 25px; border-radius: 15px; margin-bottom: 30px;">
                    <h4 style="color: #333; margin-bottom: 20px;">Order Summary</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Gift Box Price:</span>
                        <span style="color: #333; font-weight: 600;">₹<span id="unit-price">{{ gift_box.total_price|floatformat:0 }}</span></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="color: #666;">Quantity:</span>
                        <span style="color: #333; font-weight: 600;"><span id="qty-display">1</span></span>
                    </div>
                    <hr style="margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="color: #333; font-size: 18px; font-weight: 600;">Total Amount:</span>
                        <span style="color: #FF6B9D; font-size: 28px; font-weight: 700;">₹<span id="total-price">{{ gift_box.total_price|floatformat:0 }}</span></span>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="theme-btn btn-style-one" style="width: 100%; padding: 15px; font-size: 18px; border-radius: 30px; background: linear-gradient(135deg, #FF6B9D 0%, #C06C84 100%); color: white; border: none; transition: all 0.3s;">
                    <i class="fas fa-check-circle" style="margin-right: 10px;"></i>
                    Confirm Order
                </button>
            </form>
        </div>
    </div>
</section>

<style>
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #E8D5C4;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.3s;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #FF6B9D;
        box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.1);
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 600;
    }
    
    .form-group label.required::after {
        content: " *";
        color: #FF6B9D;
    }
    
    .theme-btn.btn-style-one:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(255,107,157,0.3);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.getElementById('quantity');
    const unitPrice = {{ gift_box.total_price }};
    
    function updateTotal() {
        const quantity = parseInt(quantityInput.value) || 1;
        const total = unitPrice * quantity;
        
        document.getElementById('qty-display').textContent = quantity;
        document.getElementById('total-price').textContent = Math.round(total);
    }
    
    quantityInput.addEventListener('input', updateTotal);
    
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.querySelector('input[name="delivery_date"]').setAttribute('min', today);
});
</script>
{% endblock %}

